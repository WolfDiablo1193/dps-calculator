<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Diablo Immortal DPS Calculator v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #020617;
      --bg-alt: #020617;
      --panel: #020617;
      --panel-alt: #020617;
      --border: #1f2937;
      --accent: #fbbf24;
      --accent-soft: rgba(251, 191, 36, 0.1);
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --error: #f97373;
      --blue-input: #1d4ed8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text);
      padding: 1.5rem;
    }

    h1, h2, h3 {
      margin: 0 0 0.5rem 0;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    h1 {
      font-size: 1.4rem;
      text-align: center;
    }

    h2 {
      font-size: 1.1rem;
    }

    h3 {
      font-size: 0.95rem;
      color: var(--accent);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: radial-gradient(circle at top left, #111827 0, #020617 40%, #000 100%);
      padding: 1rem 1.25rem 1.5rem;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7);
    }

    .title-sub {
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    /* Phase tabs */
    .tabs {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .tab-button {
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-muted);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      cursor: pointer;
      transition: all 0.18s ease-out;
    }

    .tab-button.active {
      background: linear-gradient(90deg, #fbbf24, #f97316);
      color: #020617;
      border-color: #fbbf24;
      box-shadow: 0 0 18px rgba(251,191,36,0.45);
    }

    .tab-button:hover:not(.active) {
      border-color: #4b5563;
      color: var(--text);
    }

    .phase-panel {
      display: none;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .phase-panel.active {
      display: grid;
    }

    @media (min-width: 900px) {
      .phase-panel {
        grid-template-columns: minmax(0, 1.15fr) minmax(0, 0.85fr);
        align-items: flex-start;
      }
    }

    /* Panels */
    .panel {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 10px;
      border: 1px solid rgba(31,41,55,0.9);
      padding: 0.75rem 0.9rem 0.85rem;
      margin-bottom: 0.75rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.4rem;
    }

    .panel-header small {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .panel-divider {
      height: 1px;
      background: linear-gradient(90deg, rgba(148,163,184,0.5), rgba(15,23,42,0.5));
      margin: 0.25rem 0 0.5rem;
    }

    /* Form grid */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.4rem 0.75rem;
    }

    @media (min-width: 768px) {
      .form-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .field label {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .field small {
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    /* Tooltip inputs (B1 – hover input itself) */
    .tooltip-input {
      position: relative;
      display: block;
      width: 100%;
    }

    .tooltip-input input {
      width: 100%;
      padding: 0.25rem 0.4rem;
      border-radius: 6px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top, #0b1120 0, #020617 60%);
      color: var(--text);
      font-size: 0.8rem;
      outline: none;
      transition: all 0.18s ease-out;
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.8);
    }

    .tooltip-input input.blue-input {
      border-color: rgba(37,99,235,0.5);
      box-shadow:
        inset 0 0 0 1px rgba(37,99,235,0.5),
        0 0 10px rgba(37,99,235,0.3);
      background: radial-gradient(circle at top, #0b1120 0, #020617 60%);
    }

    .tooltip-input input:focus {
      border-color: var(--accent);
      box-shadow:
        inset 0 0 0 1px rgba(251,191,36,0.7),
        0 0 14px rgba(251,191,36,0.35);
    }

    .tooltip-input .tooltip-text {
      visibility: hidden;
      opacity: 0;
      width: 260px;
      background: rgba(15, 23, 42, 0.98);
      color: #f9fafb;
      text-align: left;
      padding: 0.5rem 0.55rem;
      border-radius: 8px;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow: 0 8px 24px rgba(0,0,0,0.75);
      position: absolute;
      z-index: 999;
      top: 110%;
      left: 0;
      transition: opacity 0.22s ease-out;
      font-size: 0.72rem;
      line-height: 1.15rem;
      pointer-events: none;
    }

    .tooltip-input:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .tooltip-text strong {
      font-weight: 600;
      color: var(--accent);
    }

    /* Equipment layout */
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.4rem;
      margin-top: 0.35rem;
    }

    @media (min-width: 900px) {
      .equipment-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    .equip-slot {
      border-radius: 8px;
      border: 1px solid rgba(31,41,55,0.9);
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), rgba(15,23,42,0.85));
      padding: 0.3rem 0.4rem 0.4rem;
    }

    .equip-slot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.25rem;
    }

    .equip-slot-header span {
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .equip-slot-header small {
      font-size: 0.6rem;
      color: var(--text-muted);
    }

    .equip-slot-body {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.2rem 0.4rem;
    }

    .equip-field label {
      font-size: 0.68rem;
      color: var(--text-muted);
    }

    .equip-field .tooltip-input input {
      font-size: 0.75rem;
    }

    /* Outputs */
    .outputs-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.35rem 0.6rem;
      margin-top: 0.25rem;
    }

    @media (min-width: 768px) {
      .outputs-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .output-field {
      border-radius: 6px;
      border: 1px solid rgba(31,41,55,0.9);
      padding: 0.3rem 0.4rem;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.8));
      font-size: 0.78rem;
    }

    .output-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.1rem;
    }

    .output-value {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--accent);
    }

    .output-note {
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }

    /* Footer hint */
    .footer-note {
      margin-top: 0.8rem;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Diablo Immortal DPS Calculator</h1>
    <div class="title-sub">
      Phase 1 / Phase 2 damage engine & build scorer<br />
      Inputs mirror blue cells from the spreadsheet. Tooltips explain where to find each stat.
    </div>

    <!-- Phase tabs -->
    <div class="tabs">
      <button class="tab-button active" data-phase="1">Phase 1 – Arcane Rift</button>
      <button class="tab-button" data-phase="2">Phase 2 – Infernal Rift</button>
    </div>

    <!-- Phase 1 panel -->
    <div id="phase-1" class="phase-panel active">
      <div>
        <!-- General modifiers -->
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 1 – General window & modifiers</h2>
            <small>Arcane Rift window, 1st phase</small>
          </div>
          <div class="panel-divider"></div>

          <div class="form-grid">
            <!-- 1st phase (seconds) -->
            <div class="field">
              <label>1st phase (seconds)</label>
              <div class="tooltip-input">
                <input id="p1_duration" type="number" step="0.01" class="blue-input" value="11.54" />
                <span class="tooltip-text">
                  <strong>Phase 1 duration</strong><br />
                  Length of your first damage window in seconds.<br />
                  Use the duration defined in your spreadsheet or Auroth's rotation window for Arcane Rift.
                </span>
              </div>
            </div>

            <!-- Resonance -->
            <div class="field">
              <label>Resonance</label>
              <div class="tooltip-input">
                <input id="p1_resonance" type="number" step="1" class="blue-input" value="1121" />
                <span class="tooltip-text">
                  <strong>Resonance (Phase 1)</strong><br />
                  Total resonance from your currently equipped legendary gems and awakenings.<br />
                  Found on your character sheet. Use your <em>current</em> build, not planned gear.<br />
                  Matches the Resonance value used in your spreadsheet for Phase 1.
                </span>
              </div>
            </div>

            <!-- BED modifier -->
            <div class="field">
              <label>BED modifier</label>
              <div class="tooltip-input">
                <input id="p1_bed" type="number" step="0.01" class="blue-input" value="1.0" />
                <span class="tooltip-text">
                  <strong>BED – Bonus Effect Damage modifier</strong><br />
                  Additive damage bucket for general damage bonuses:<br />
                  Primary Damage %, Skill Damage %, set bonuses, and some gem effects.<br />
                  Use the same total BED value (as a multiplier) that your Phase 1 sheet uses.
                </span>
              </div>
            </div>

            <!-- Vithus BED -->
            <div class="field">
              <label>Vithus BED</label>
              <div class="tooltip-input">
                <input id="p1_vithus_bed" type="number" step="0.01" class="blue-input" value="0.30" />
                <span class="tooltip-text">
                  <strong>Vithu's Urge bonus damage</strong><br />
                  Additional BED from the Vithu's set during active uptime.<br />
                  Enter as a decimal (0.30 = 30%). Mirror the value in your Phase 1 sheet.
                </span>
              </div>
            </div>

            <!-- Baron HED -->
            <div class="field">
              <label>Baron HED</label>
              <div class="tooltip-input">
                <input id="p1_baron_hed" type="number" step="0.01" class="blue-input" value="0.30" />
                <span class="tooltip-text">
                  <strong>Baron – Heroic Effect Damage</strong><br />
                  HED contribution from the Baron set. Enter as a decimal (0.30 = 30%).<br />
                  Use the same value that feeds into your HED bucket in the sheet.
                </span>
              </div>
            </div>

            <!-- Potency HED -->
            <div class="field">
              <label>Potency HED</label>
              <div class="tooltip-input">
                <input id="p1_potency_hed" type="number" step="0.01" class="blue-input" value="0.35" />
                <span class="tooltip-text">
                  <strong>Potency-based Heroic Effect Damage</strong><br />
                  HED from Potency scaling. Enter the effective multiplier from your sheet as a decimal.<br />
                  This reflects the Potency vs Willpower interaction in Auroth's damage bucket breakdown.
                </span>
              </div>
            </div>

            <!-- Misery Elixir HED -->
            <div class="field">
              <label>Misery Elixir HED</label>
              <div class="tooltip-input">
                <input id="p1_misery_hed" type="number" step="0.01" class="blue-input" value="0.00" />
                <span class="tooltip-text">
                  <strong>Misery Elixir Heroic Damage</strong><br />
                  Temporary HED bonus from Misery Elixir. Enter as decimal (0.20 = 20%).<br />
                  Use 0 if not active in this phase, matching your sheet.
                </span>
              </div>
            </div>

            <!-- HED modifier -->
            <div class="field">
              <label>HED Modifier (auto)</label>
              <div class="tooltip-input">
                <input id="p1_hed_modifier" type="number" step="0.001" value="1.0" disabled />
                <span class="tooltip-text">
                  <strong>Heroic Effect Damage modifier</strong><br />
                  Combined HED multiplier based on Baron, Potency, and Misery values.<br />
                  In your sheet this is typically (1 + Baron) × (1 + Potency) × (1 + Misery).<br />
                  This field is auto-calculated by the calculator.
                </span>
              </div>
              <small>Auto: (1 + Baron) × (1 + Potency) × (1 + Misery)</small>
            </div>

            <!-- CDR Score -->
            <div class="field">
              <label>CDR Score</label>
              <div class="tooltip-input">
                <input id="p1_cdr" type="number" step="0.01" class="blue-input" value="1.43" />
                <span class="tooltip-text">
                  <strong>Cooldown Reduction score</strong><br />
                  Effective multiplier for how CDR improves damage uptime.<br />
                  Use the exact CDR score from your Phase 1 spreadsheet for parity.
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment -->
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 1 – Equipment & stats</h2>
            <small>Only blue cells from the spreadsheet are inputs</small>
          </div>
          <div class="panel-divider"></div>

          <div class="equipment-grid">
            <!-- Example slot: Neck -->
            <div class="equip-slot">
              <div class="equip-slot-header">
                <span>Neck</span>
                <small>Totals for this item</small>
              </div>
              <div class="equip-slot-body">
                <div class="equip-field">
                  <label>Item Base DMG</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_base" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Item Base Damage</strong><br />
                      Use the base damage value printed on the necklace item tooltip.<br />
                      This should match the blue input cell for Neck Base DMG in your Phase 1 sheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Base DMG %</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_base_pct" type="number" step="0.01" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Base Damage % increase</strong><br />
                      Any explicit "% base damage" for this item. Enter as whole percent (12 = 12%).<br />
                      Mirror the blue input for Neck Base DMG Increased in your sheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Rune Increase</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_rune" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Rune Increase</strong><br />
                      Flat damage gained from runes slotted into this item.<br />
                      Copy the value from your spreadsheet's Neck Rune cell.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Socket Rank</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_socket" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Socket rank contribution</strong><br />
                      Total gem rank level in this item's sockets for damage-relevant gems.<br />
                      Reflects the same value as your Neck Socket Rank blue cell.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Paragon DMG</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_paragon" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Paragon Damage</strong><br />
                      Flat damage from Paragon nodes attributed to this slot (if your sheet splits that way).<br />
                      If your sheet uses global Paragon only, leave this 0.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Horadrim</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_horadrim" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Horadrim Vessel contribution</strong><br />
                      Flat damage bonus from Horadrim tied to this slot, if your sheet tracks it per item.<br />
                      Otherwise, leave this 0 and use a more global field later.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Intelligence</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_int" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Intelligence</strong><br />
                      Intelligence stat shown on the item. This will be converted to damage using your sheet's formula.<br />
                      Matches the blue Intelligence cell for this slot.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Tourmaline</label>
                  <div class="tooltip-input">
                    <input id="p1_neck_tourm" type="number" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Neck – Tourmaline damage</strong><br />
                      Flat damage granted by Tourmaline gems in this slot, if tracked separately.<br />
                      Use the same value as the Neck Tourmaline blue cell.
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- You can duplicate the slot structure below for other items: Ring1, Ring2, Gloves, etc. -->
            <!-- For now, provide aggregate fields to keep this v2 manageable but structured. -->

            <div class="equip-slot">
              <div class="equip-slot-header">
                <span>Phase 1 totals</span>
                <small>Global equipment totals</small>
              </div>
              <div class="equip-slot-body">
                <div class="equip-field">
                  <label>Total Item Base DMG</label>
                  <div class="tooltip-input">
                    <input id="p1_total_base" type="number" class="blue-input" value="7105" />
                    <span class="tooltip-text">
                      <strong>Total Item Base Damage (Phase 1)</strong><br />
                      Sum of base damage from all equipped items used in Phase 1.<br />
                      This should match the total Item Base DMG cell in your sheet (e.g., 7105).
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Rune Increase</label>
                  <div class="tooltip-input">
                    <input id="p1_total_rune" type="number" class="blue-input" value="342" />
                    <span class="tooltip-text">
                      <strong>Total Rune Increase</strong><br />
                      Sum of all rune-based flat damage bonuses for Phase 1 equipment.<br />
                      Mirror the total rune damage cell from your spreadsheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Socket Rank</label>
                  <div class="tooltip-input">
                    <input id="p1_total_socket" type="number" class="blue-input" value="16" />
                    <span class="tooltip-text">
                      <strong>Total Socket Rank</strong><br />
                      Aggregate socket rank contribution (e.g., 16) from all relevant gems.<br />
                      Use the same total as in your Phase 1 socket rank cell.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Paragon DMG total</label>
                  <div class="tooltip-input">
                    <input id="p1_total_paragon" type="number" class="blue-input" value="8800" />
                    <span class="tooltip-text">
                      <strong>Total Paragon Damage</strong><br />
                      Flat damage from Paragon that contributes to Phase 1 damage.<br />
                      Use the total Paragon DMG value used in your spreadsheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Horadrim total</label>
                  <div class="tooltip-input">
                    <input id="p1_total_horadrim" type="number" class="blue-input" value="12" />
                    <span class="tooltip-text">
                      <strong>Total Horadrim damage</strong><br />
                      Combined flat damage from Horadrim vessels for Phase 1.<br />
                      Match the total used in your sheet (e.g., 12).
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Intelligence</label>
                  <div class="tooltip-input">
                    <input id="p1_total_int" type="number" class="blue-input" value="1002" />
                    <span class="tooltip-text">
                      <strong>Total Intelligence (Phase 1)</strong><br />
                      Sum of Intelligence from all relevant sources used in the sheet for Phase 1.<br />
                      Copy this from your Phase 1 total INT cell.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Tourmaline</label>
                  <div class="tooltip-input">
                    <input id="p1_total_tourm" type="number" class="blue-input" value="572" />
                    <span class="tooltip-text">
                      <strong>Total Tourmaline damage</strong><br />
                      Sum of flat damage from all Tourmaline gems contributing to Phase 1.<br />
                      Reflect the total value from your spreadsheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>DMG Modifiers %</label>
                  <div class="tooltip-input">
                    <input id="p1_dmg_mod_pct" type="number" step="0.01" class="blue-input" value="48" />
                    <span class="tooltip-text">
                      <strong>Total Damage Modifiers %</strong><br />
                      Combined "% increased damage" effects for Phase 1 not already captured in BED fields.<br />
                      Enter as whole percent (48 = 48%), matching the sheet.
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="equip-slot">
              <div class="equip-slot-header">
                <span>Buckets & crit</span>
                <small>B1–B4 & crit scores</small>
              </div>
              <div class="equip-slot-body">
                <div class="equip-field">
                  <label>B1 (General/BED) score</label>
                  <div class="tooltip-input">
                    <input id="p1_b1" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B1 – General / BED bucket</strong><br />
                      Combined BED-like multiplier from general damage bonuses (primary, skill, sets, etc.).<br />
                      If your sheet gives a B1 score number, put that exact value here.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B2 (Legendary Gems) score</label>
                  <div class="tooltip-input">
                    <input id="p1_b2" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B2 – Legendary Gems</strong><br />
                      Damage bucket for legendary gem contributions.<br />
                      Use the same B2 score value your sheet outputs for Phase 1.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B3 (Buff/Debuff) score</label>
                  <div class="tooltip-input">
                    <input id="p1_b3" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B3 – Buffs & Debuffs</strong><br />
                      Bucket for effects such as Shock, Lingering Wounds, Poison Golem debuff, etc.<br />
                      Mirror the B3 score from your sheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B4 (Combat Rating) score</label>
                  <div class="tooltip-input">
                    <input id="p1_b4" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B4 – Combat Rating bucket</strong><br />
                      Multiplier or score derived from CR difference vs content level.<br />
                      Use the B4 score your sheet calculates.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit Chance score</label>
                  <div class="tooltip-input">
                    <input id="p1_crit_chance" type="number" step="0.01" class="blue-input" value="3.82" />
                    <span class="tooltip-text">
                      <strong>Crit chance (Phase 1)</strong><br />
                      Effective critical hit chance as a percent (3.82 = 3.82%).<br />
                      Use the exact crit chance cell value from your sheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit Damage score</label>
                  <div class="tooltip-input">
                    <input id="p1_crit_dmg" type="number" step="0.01" class="blue-input" value="30.12" />
                    <span class="tooltip-text">
                      <strong>Crit damage (Phase 1)</strong><br />
                      Effective crit damage bonus as a percent. Use the value from your sheet.<br />
                      This will be used to compute the crit score.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit score (auto)</label>
                  <div class="tooltip-input">
                    <input id="p1_crit_score" type="number" step="0.001" value="1.0" disabled />
                    <span class="tooltip-text">
                      <strong>Crit score</strong><br />
                      Derived metric combining crit chance and crit damage into a single multiplicative factor.<br />
                      JS logic can be updated to match your sheet’s crit formula exactly.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>AS score</label>
                  <div class="tooltip-input">
                    <input id="p1_as_score" type="number" step="0.01" class="blue-input" value="22" />
                    <span class="tooltip-text">
                      <strong>Attack speed score</strong><br />
                      Effective attack speed bonus as percent (22 = 22%) or a precomputed score from your sheet.<br />
                      This will feed into the Build Score with AS calculation.
                    </span>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Outputs column -->
      <div>
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 1 – Outputs</h2>
            <small>Matches Phase 1 outputs in the spreadsheet</small>
          </div>
          <div class="panel-divider"></div>

          <div class="outputs-grid">
            <div class="output-field">
              <div class="output-label">Base DMG</div>
              <div id="p1_base_dmg" class="output-value">0</div>
              <div class="output-note">Aggregated base damage before buckets and crit.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Normal DMG</div>
              <div id="p1_normal_dmg" class="output-value">0</div>
              <div class="output-note">Non-crit damage after all multipliers.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Crit DMG</div>
              <div id="p1_crit_dmg_out" class="output-value">0</div>
              <div class="output-note">Critical damage for comparison.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Avg. DMG</div>
              <div id="p1_avg_dmg" class="output-value">0</div>
              <div class="output-note">Weighted average using crit chance.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B1 score</div>
              <div id="p1_b1_out" class="output-value">0</div>
              <div class="output-note">Echoes B1 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B2 score</div>
              <div id="p1_b2_out" class="output-value">0</div>
              <div class="output-note">Echoes B2 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B3 score</div>
              <div id="p1_b3_out" class="output-value">0</div>
              <div class="output-note">Echoes B3 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B4 score</div>
              <div id="p1_b4_out" class="output-value">0</div>
              <div class="output-note">Echoes B4 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Crit score</div>
              <div id="p1_crit_score_out" class="output-value">0</div>
              <div class="output-note">Score from crit chance & damage.</div>
            </div>
            <div class="output-field">
              <div class="output-label">AS Score</div>
              <div id="p1_as_score_out" class="output-value">0</div>
              <div class="output-note">Attack speed effect on DPS.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Build Score</div>
              <div id="p1_build_score" class="output-value">0</div>
              <div class="output-note">Core build power for Phase 1.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Build Score with AS</div>
              <div id="p1_build_score_as" class="output-value">0</div>
              <div class="output-note">Build power including attack speed.</div>
            </div>
            <div class="output-field">
              <div class="output-label">20 Sec Score (Phase 1)</div>
              <div id="p1_20_sec" class="output-value">0</div>
              <div class="output-note">Phase 1 contribution over a 20-second window.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Phase 2 panel (mirrors Phase 1 but with Phase 2 IDs) -->
    <div id="phase-2" class="phase-panel">
      <div>
        <!-- General modifiers -->
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 2 – General window & modifiers</h2>
            <small>Infernal Rift window, 2nd phase</small>
          </div>
          <div class="panel-divider"></div>

          <div class="form-grid">
            <div class="field">
              <label>2nd phase (seconds)</label>
              <div class="tooltip-input">
                <input id="p2_duration" type="number" step="0.01" class="blue-input" value="8.46" />
                <span class="tooltip-text">
                  <strong>Phase 2 duration</strong><br />
                  Length of your second damage window in seconds.<br />
                  Use the duration from your Phase 2 section in the spreadsheet.
                </span>
              </div>
            </div>

            <div class="field">
              <label>Resonance</label>
              <div class="tooltip-input">
                <input id="p2_resonance" type="number" step="1" class="blue-input" value="1121" />
                <span class="tooltip-text">
                  <strong>Resonance (Phase 2)</strong><br />
                  Resonance for your Phase 2 gear setup or alternate gem layout.<br />
                  This may differ from Phase 1 if you swap gems or items.
                </span>
              </div>
            </div>

            <div class="field">
              <label>BED modifier</label>
              <div class="tooltip-input">
                <input id="p2_bed" type="number" step="0.01" class="blue-input" value="1.0" />
                <span class="tooltip-text">
                  <strong>BED – Bonus Effect Damage</strong><br />
                  Total BED multiplier for Phase 2.<br />
                  Use the same approach as Phase 1 but with Phase 2 values.
                </span>
              </div>
            </div>

            <div class="field">
              <label>Vithus BED</label>
              <div class="tooltip-input">
                <input id="p2_vithus_bed" type="number" step="0.01" class="blue-input" value="0.30" />
                <span class="tooltip-text">
                  <strong>Vithu's Urge bonus damage</strong><br />
                  Phase 2 Vithu's uptime/bonus, as a decimal.<br />
                  Mirror the Phase 2 spreadsheet value.
                </span>
              </div>
            </div>

            <div class="field">
              <label>Baron HED</label>
              <div class="tooltip-input">
                <input id="p2_baron_hed" type="number" step="0.01" class="blue-input" value="0.30" />
                <span class="tooltip-text">
                  <strong>Baron – Heroic Effect Damage</strong><br />
                  Phase 2 Baron HED multiplier as decimal.
                </span>
              </div>
            </div>

            <div class="field">
              <label>Potency HED</label>
              <div class="tooltip-input">
                <input id="p2_potency_hed" type="number" step="0.01" class="blue-input" value="0.35" />
                <span class="tooltip-text">
                  <strong>Potency-based HED</strong><br />
                  Phase 2 Potency HED contribution.<br />
                  Match the Phase 2 spreadsheet value.
                </span>
              </div>
            </div>

            <div class="field">
              <label>Misery Elixir HED</label>
              <div class="tooltip-input">
                <input id="p2_misery_hed" type="number" step="0.01" class="blue-input" value="0.00" />
                <span class="tooltip-text">
                  <strong>Misery Elixir HED (Phase 2)</strong><br />
                  Misery Elixir Heroic bonus if active during Phase 2 only.<br />
                  Enter 0 if not used.
                </span>
              </div>
            </div>

            <div class="field">
              <label>HED Modifier (auto)</label>
              <div class="tooltip-input">
                <input id="p2_hed_modifier" type="number" step="0.001" value="1.0" disabled />
                <span class="tooltip-text">
                  <strong>Heroic Effect Damage modifier</strong><br />
                  Combined HED multiplier for Phase 2.<br />
                  Same structure as Phase 1, but with Phase 2 values.
                </span>
              </div>
              <small>Auto: (1 + Baron) × (1 + Potency) × (1 + Misery)</small>
            </div>

            <div class="field">
              <label>CDR Score</label>
              <div class="tooltip-input">
                <input id="p2_cdr" type="number" step="0.01" class="blue-input" value="1.43" />
                <span class="tooltip-text">
                  <strong>Cooldown Reduction score</strong><br />
                  Copy the Phase 2 CDR Score value from your spreadsheet.
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment -->
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 2 – Equipment & stats</h2>
            <small>Same structure, Phase 2 values</small>
          </div>
          <div class="panel-divider"></div>

          <div class="equipment-grid">
            <div class="equip-slot">
              <div class="equip-slot-header">
                <span>Phase 2 totals</span>
                <small>Global equipment totals</small>
              </div>
              <div class="equip-slot-body">
                <div class="equip-field">
                  <label>Total Item Base DMG</label>
                  <div class="tooltip-input">
                    <input id="p2_total_base" type="number" class="blue-input" value="7105" />
                    <span class="tooltip-text">
                      <strong>Total Item Base Damage (Phase 2)</strong><br />
                      Sum of all base damage values used for Phase 2.<br />
                      Should match the Phase 2 spreadsheet total.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Rune Increase</label>
                  <div class="tooltip-input">
                    <input id="p2_total_rune" type="number" class="blue-input" value="342" />
                    <span class="tooltip-text">
                      <strong>Total Rune Increase</strong><br />
                      Phase 2 rune-based flat damage total.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Socket Rank</label>
                  <div class="tooltip-input">
                    <input id="p2_total_socket" type="number" class="blue-input" value="16" />
                    <span class="tooltip-text">
                      <strong>Total Socket Rank</strong><br />
                      Socket rank sum for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Paragon DMG total</label>
                  <div class="tooltip-input">
                    <input id="p2_total_paragon" type="number" class="blue-input" value="8800" />
                    <span class="tooltip-text">
                      <strong>Total Paragon Damage</strong><br />
                      Phase 2 Paragon damage contribution.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Horadrim total</label>
                  <div class="tooltip-input">
                    <input id="p2_total_horadrim" type="number" class="blue-input" value="12" />
                    <span class="tooltip-text">
                      <strong>Total Horadrim damage</strong><br />
                      Phase 2 Horadrim vessel damage total.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Intelligence</label>
                  <div class="tooltip-input">
                    <input id="p2_total_int" type="number" class="blue-input" value="1002" />
                    <span class="tooltip-text">
                      <strong>Total Intelligence (Phase 2)</strong><br />
                      Sum of INT used for Phase 2 damage calculations.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Total Tourmaline</label>
                  <div class="tooltip-input">
                    <input id="p2_total_tourm" type="number" class="blue-input" value="572" />
                    <span class="tooltip-text">
                      <strong>Total Tourmaline damage</strong><br />
                      Flat Tourmaline contribution for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>DMG Modifiers %</label>
                  <div class="tooltip-input">
                    <input id="p2_dmg_mod_pct" type="number" step="0.01" class="blue-input" value="48" />
                    <span class="tooltip-text">
                      <strong>Total Damage Modifiers %</strong><br />
                      Phase 2 total "% increased damage" modifiers, as in the sheet.
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="equip-slot">
              <div class="equip-slot-header">
                <span>Buckets & crit</span>
                <small>Phase 2 scores</small>
              </div>
              <div class="equip-slot-body">
                <div class="equip-field">
                  <label>B1 (General/BED) score</label>
                  <div class="tooltip-input">
                    <input id="p2_b1" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B1 – General / BED bucket (Phase 2)</strong><br />
                      Use the B1 score from your Phase 2 sheet.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B2 (Legendary Gems) score</label>
                  <div class="tooltip-input">
                    <input id="p2_b2" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B2 – Legendary Gems (Phase 2)</strong><br />
                      Use Phase 2 legendary gem bucket score.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B3 (Buff/Debuff) score</label>
                  <div class="tooltip-input">
                    <input id="p2_b3" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B3 – Buffs & Debuffs (Phase 2)</strong><br />
                      Includes Shock, Poison, Lingering Wounds, etc. for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>B4 (Combat Rating) score</label>
                  <div class="tooltip-input">
                    <input id="p2_b4" type="number" step="0.001" class="blue-input" value="1.0" />
                    <span class="tooltip-text">
                      <strong>B4 – Combat Rating (Phase 2)</strong><br />
                      CR-based damage bucket for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit Chance score</label>
                  <div class="tooltip-input">
                    <input id="p2_crit_chance" type="number" step="0.01" class="blue-input" value="11.3" />
                    <span class="tooltip-text">
                      <strong>Crit chance (Phase 2)</strong><br />
                      Effective crit chance % for Phase 2 rotations.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit Damage score</label>
                  <div class="tooltip-input">
                    <input id="p2_crit_dmg" type="number" step="0.01" class="blue-input" value="49" />
                    <span class="tooltip-text">
                      <strong>Crit damage (Phase 2)</strong><br />
                      Effective crit damage bonus % for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>Crit score (auto)</label>
                  <div class="tooltip-input">
                    <input id="p2_crit_score" type="number" step="0.001" value="1.0" disabled />
                    <span class="tooltip-text">
                      <strong>Crit score (Phase 2)</strong><br />
                      Score derived from crit chance and crit damage for Phase 2.
                    </span>
                  </div>
                </div>
                <div class="equip-field">
                  <label>AS score</label>
                  <div class="tooltip-input">
                    <input id="p2_as_score" type="number" step="0.01" class="blue-input" value="0" />
                    <span class="tooltip-text">
                      <strong>Attack speed score (Phase 2)</strong><br />
                      Effective attack speed effect on DPS. Use Phase 2 value from the sheet.
                    </span>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- Outputs column -->
      <div>
        <div class="panel">
          <div class="panel-header">
            <h2>Phase 2 – Outputs</h2>
            <small>Matches Phase 2 outputs in the spreadsheet</small>
          </div>
          <div class="panel-divider"></div>

          <div class="outputs-grid">
            <div class="output-field">
              <div class="output-label">Base DMG</div>
              <div id="p2_base_dmg" class="output-value">0</div>
              <div class="output-note">Aggregated base damage before buckets and crit.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Normal DMG</div>
              <div id="p2_normal_dmg" class="output-value">0</div>
              <div class="output-note">Non-crit damage after all multipliers.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Crit DMG</div>
              <div id="p2_crit_dmg_out" class="output-value">0</div>
              <div class="output-note">Critical damage for comparison.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Avg. DMG</div>
              <div id="p2_avg_dmg" class="output-value">0</div>
              <div class="output-note">Weighted average using crit chance.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B1 score</div>
              <div id="p2_b1_out" class="output-value">0</div>
              <div class="output-note">Echoes B1 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B2 score</div>
              <div id="p2_b2_out" class="output-value">0</div>
              <div class="output-note">Echoes B2 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B3 score</div>
              <div id="p2_b3_out" class="output-value">0</div>
              <div class="output-note">Echoes B3 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">B4 score</div>
              <div id="p2_b4_out" class="output-value">0</div>
              <div class="output-note">Echoes B4 input or formula result.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Crit score</div>
              <div id="p2_crit_score_out" class="output-value">0</div>
              <div class="output-note">Score from crit chance & damage.</div>
            </div>
            <div class="output-field">
              <div class="output-label">AS Score</div>
              <div id="p2_as_score_out" class="output-value">0</div>
              <div class="output-note">Attack speed effect on DPS.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Build Score</div>
              <div id="p2_build_score" class="output-value">0</div>
              <div class="output-note">Core build power for Phase 2.</div>
            </div>
            <div class="output-field">
              <div class="output-label">Build Score with AS</div>
              <div id="p2_build_score_as" class="output-value">0</div>
              <div class="output-note">Build power including attack speed.</div>
            </div>
            <div class="output-field">
              <div class="output-label">20 Sec Score (Phase 2)</div>
              <div id="p2_20_sec" class="output-value">0</div>
              <div class="output-note">Phase 2 contribution over a 20-second window.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-note">
      This v2 layout is a structured scaffold. Formulas can be tuned to match the Excel engine exactly.
    </div>
  </div>

  <script>
    // Phase tab switching
    const tabButtons = document.querySelectorAll('.tab-button');
    const phasePanels = document.querySelectorAll('.phase-panel');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-phase');
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        phasePanels.forEach(panel => {
          panel.classList.toggle('active', panel.id === `phase-${target}`);
        });
      });
    });

    // Basic calculator logic (placeholder formulas – to be aligned with Excel)
    function calcPhase1() {
      const duration = parseFloat(document.getElementById('p1_duration').value) || 0;
      const resonance = parseFloat(document.getElementById('p1_resonance').value) || 0;
      const bed = parseFloat(document.getElementById('p1_bed').value) || 1;
      const vithusBed = parseFloat(document.getElementById('p1_vithus_bed').value) || 0;
      const baron = parseFloat(document.getElementById('p1_baron_hed').value) || 0;
      const potency = parseFloat(document.getElementById('p1_potency_hed').value) || 0;
      const misery = parseFloat(document.getElementById('p1_misery_hed').value) || 0;
      const cdr = parseFloat(document.getElementById('p1_cdr').value) || 1;

      const totalBase = parseFloat(document.getElementById('p1_total_base').value) || 0;
      const totalRune = parseFloat(document.getElementById('p1_total_rune').value) || 0;
      const totalSocket = parseFloat(document.getElementById('p1_total_socket').value) || 0;
      const totalParagon = parseFloat(document.getElementById('p1_total_paragon').value) || 0;
      const totalHoradrim = parseFloat(document.getElementById('p1_total_horadrim').value) || 0;
      const totalInt = parseFloat(document.getElementById('p1_total_int').value) || 0;
      const totalTourm = parseFloat(document.getElementById('p1_total_tourm').value) || 0;
      const dmgModPct = parseFloat(document.getElementById('p1_dmg_mod_pct').value) || 0;

      const b1 = parseFloat(document.getElementById('p1_b1').value) || 1;
      const b2 = parseFloat(document.getElementById('p1_b2').value) || 1;
      const b3 = parseFloat(document.getElementById('p1_b3').value) || 1;
      const b4 = parseFloat(document.getElementById('p1_b4').value) || 1;

      const critChance = (parseFloat(document.getElementById('p1_crit_chance').value) || 0) / 100;
      const critDmgPct = (parseFloat(document.getElementById('p1_crit_dmg').value) || 0) / 100;
      const asScorePct = (parseFloat(document.getElementById('p1_as_score').value) || 0) / 100;

      // HED modifier (placeholder structure)
      const hedModifier = (1 + baron) * (1 + potency) * (1 + misery);
      document.getElementById('p1_hed_modifier').value = hedModifier.toFixed(3);

      // Simple base damage model (placeholder)
      const intToDmg = totalInt * 0.3;
      const resonanceMult = 1 + resonance * 0.0005;
      const dmgModMult = 1 + dmgModPct / 100;
      const flatBase = totalBase + totalRune + totalParagon + totalHoradrim + totalTourm + intToDmg;

      const baseDmg = flatBase * resonanceMult * dmgModMult;
      document.getElementById('p1_base_dmg').textContent = baseDmg.toFixed(1);

      // Crit score (placeholder: 1 + chance * crit bonus)
      const critScore = 1 + critChance * critDmgPct;
      document.getElementById('p1_crit_score').value = critScore.toFixed(3);
      document.getElementById('p1_crit_score_out').textContent = critScore.toFixed(3);

      // Normal / crit damage (placeholder)
      const normalDmg = baseDmg * bed * (1 + vithusBed) * hedModifier * b1 * b2 * b3 * b4 * cdr;
      const critDmg = normalDmg * (1 + critDmgPct);
      const avgDmg = normalDmg * (1 - critChance) + critDmg * critChance;

            document.getElementById('p1_normal_dmg').textContent = normalDmg.toFixed(1);
      document.getElementById('p1_crit_dmg_out').textContent = critDmg.toFixed(1);
      document.getElementById('p1_avg_dmg').textContent = avgDmg.toFixed(1);

      // Echo B1–B4
      document.getElementById('p1_b1_out').textContent = b1.toFixed(3);
      document.getElementById('p1_b2_out').textContent = b2.toFixed(3);
      document.getElementById('p1_b3_out').textContent = b3.toFixed(3);
      document.getElementById('p1_b4_out').textContent = b4.toFixed(3);

      // AS score output (for now just echo as a multiplier)
      const asScoreMult = 1 + asScorePct;
      document.getElementById('p1_as_score_out').textContent = asScoreMult.toFixed(3);

      // Build Score (placeholder: average damage × bucket multipliers)
      const buildScore = avgDmg;
      document.getElementById('p1_build_score').textContent = buildScore.toFixed(2);

      // Build Score with AS (placeholder: multiply by AS effect)
      const buildScoreAS = buildScore * asScoreMult;
      document.getElementById('p1_build_score_as').textContent = buildScoreAS.toFixed(2);

      // 20-sec score (placeholder: scale by phase duration / 20)
      const phaseShare = duration / 20;
      const score20 = buildScoreAS * phaseShare;
      document.getElementById('p1_20_sec').textContent = score20.toFixed(2);
    }

    function calcPhase2() {
      const duration = parseFloat(document.getElementById('p2_duration').value) || 0;
      const resonance = parseFloat(document.getElementById('p2_resonance').value) || 0;
      const bed = parseFloat(document.getElementById('p2_bed').value) || 1;
      const vithusBed = parseFloat(document.getElementById('p2_vithus_bed').value) || 0;
      const baron = parseFloat(document.getElementById('p2_baron_hed').value) || 0;
      const potency = parseFloat(document.getElementById('p2_potency_hed').value) || 0;
      const misery = parseFloat(document.getElementById('p2_misery_hed').value) || 0;
      const cdr = parseFloat(document.getElementById('p2_cdr').value) || 1;

      const totalBase = parseFloat(document.getElementById('p2_total_base').value) || 0;
      const totalRune = parseFloat(document.getElementById('p2_total_rune').value) || 0;
      const totalSocket = parseFloat(document.getElementById('p2_total_socket').value) || 0;
      const totalParagon = parseFloat(document.getElementById('p2_total_paragon').value) || 0;
      const totalHoradrim = parseFloat(document.getElementById('p2_total_horadrim').value) || 0;
      const totalInt = parseFloat(document.getElementById('p2_total_int').value) || 0;
      const totalTourm = parseFloat(document.getElementById('p2_total_tourm').value) || 0;
      const dmgModPct = parseFloat(document.getElementById('p2_dmg_mod_pct').value) || 0;

      const b1 = parseFloat(document.getElementById('p2_b1').value) || 1;
      const b2 = parseFloat(document.getElementById('p2_b2').value) || 1;
      const b3 = parseFloat(document.getElementById('p2_b3').value) || 1;
      const b4 = parseFloat(document.getElementById('p2_b4').value) || 1;

      const critChance = (parseFloat(document.getElementById('p2_crit_chance').value) || 0) / 100;
      const critDmgPct = (parseFloat(document.getElementById('p2_crit_dmg').value) || 0) / 100;
      const asScorePct = (parseFloat(document.getElementById('p2_as_score').value) || 0) / 100;

      const hedModifier = (1 + baron) * (1 + potency) * (1 + misery);
      document.getElementById('p2_hed_modifier').value = hedModifier.toFixed(3);

      const intToDmg = totalInt * 0.3;
      const resonanceMult = 1 + resonance * 0.0005;
      const dmgModMult = 1 + dmgModPct / 100;
      const flatBase = totalBase + totalRune + totalParagon + totalHoradrim + totalTourm + intToDmg;

      const baseDmg = flatBase * resonanceMult * dmgModMult;
      document.getElementById('p2_base_dmg').textContent = baseDmg.toFixed(1);

      const critScore = 1 + critChance * critDmgPct;
      document.getElementById('p2_crit_score').value = critScore.toFixed(3);
      document.getElementById('p2_crit_score_out').textContent = critScore.toFixed(3);

      const normalDmg = baseDmg * bed * (1 + vithusBed) * hedModifier * b1 * b2 * b3 * b4 * cdr;
      const critDmg = normalDmg * (1 + critDmgPct);
      const avgDmg = normalDmg * (1 - critChance) + critDmg * critChance;

      document.getElementById('p2_normal_dmg').textContent = normalDmg.toFixed(1);
      document.getElementById('p2_crit_dmg_out').textContent = critDmg.toFixed(1);
      document.getElementById('p2_avg_dmg').textContent = avgDmg.toFixed(1);

      document.getElementById('p2_b1_out').textContent = b1.toFixed(3);
      document.getElementById('p2_b2_out').textContent = b2.toFixed(3);
      document.getElementById('p2_b3_out').textContent = b3.toFixed(3);
      document.getElementById('p2_b4_out').textContent = b4.toFixed(3);

      const asScoreMult = 1 + asScorePct;
      document.getElementById('p2_as_score_out').textContent = asScoreMult.toFixed(3);

      const buildScore = avgDmg;
      document.getElementById('p2_build_score').textContent = buildScore.toFixed(2);

      const buildScoreAS = buildScore * asScoreMult;
      document.getElementById('p2_build_score_as').textContent = buildScoreAS.toFixed(2);

      const phaseShare = duration / 20;
      const score20 = buildScoreAS * phaseShare;
      document.getElementById('p2_20_sec').textContent = score20.toFixed(2);
    }

    // Recalculate on input change
    const idsToWatch = [
      'p1_duration','p1_resonance','p1_bed','p1_vithus_bed','p1_baron_hed','p1_potency_hed','p1_misery_hed',
      'p1_cdr','p1_total_base','p1_total_rune','p1_total_socket','p1_total_paragon','p1_total_horadrim',
      'p1_total_int','p1_total_tourm','p1_dmg_mod_pct','p1_b1','p1_b2','p1_b3','p1_b4',
      'p1_crit_chance','p1_crit_dmg','p1_as_score',
      'p2_duration','p2_resonance','p2_bed','p2_vithus_bed','p2_baron_hed','p2_potency_hed','p2_misery_hed',
      'p2_cdr','p2_total_base','p2_total_rune','p2_total_socket','p2_total_paragon','p2_total_horadrim',
      'p2_total_int','p2_total_tourm','p2_dmg_mod_pct','p2_b1','p2_b2','p2_b3','p2_b4',
      'p2_crit_chance','p2_crit_dmg','p2_as_score'
    ];

    idsToWatch.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('input', () => {
          calcPhase1();
          calcPhase2();
        });
      }
    });

    // Initial calculation on load
    calcPhase1();
    calcPhase2();
  </script>
</body>
</html>
