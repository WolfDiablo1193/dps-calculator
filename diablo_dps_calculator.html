<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Diablo Immortal DPS Calculator – Auroth Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #020617;
      --bg-panel: rgba(15,23,42,0.97);
      --bg-panel-sub: rgba(15,23,42,0.9);
      --border-strong: rgba(148,163,184,0.8);
      --border-soft: rgba(51,65,85,0.9);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --accent-gold: #fbbf24;
      --accent-gold-soft: rgba(251,191,36,0.45);
      --accent-red: #f97373;
      --accent-blue: #38bdf8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 22px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background:
        radial-gradient(circle at top, rgba(15,118,110,0.18), transparent 55%),
        radial-gradient(circle at bottom, rgba(30,64,175,0.22), transparent 55%),
        linear-gradient(to bottom, #020617, #020617 52%, #020617);
      color: var(--text-main);
    }

    .title-frame {
      max-width: 900px;
      margin: 0 auto 16px auto;
      padding: 12px 16px 16px 16px;
      border-radius: 16px;
      background:
        radial-gradient(circle at 0 0, rgba(59,130,246,0.4), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(251,191,36,0.4), transparent 55%),
        linear-gradient(to bottom, rgba(15,23,42,0.98), rgba(15,23,42,0.96));
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 18px 38px rgba(0,0,0,0.85);
      position: relative;
      overflow: hidden;
    }

    .title-frame::before {
      content: "";
      position: absolute;
      inset: -60%;
      background:
        radial-gradient(circle at 10% 0%, rgba(96,165,250,0.22), transparent 55%),
        radial-gradient(circle at 90% 0%, rgba(251,191,36,0.26), transparent 52%);
      opacity: 0.7;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    h1 {
      margin: 0;
      font-family: "Cinzel", serif;
      font-size: 1.6rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #f9fafb;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .subtitle {
      margin-top: 4px;
      text-align: center;
      font-size: 0.78rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--text-muted);
      position: relative;
      z-index: 1;
    }

    .phase-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 14px;
      align-items: flex-start;
    }

    .phase {
      flex: 1 1 0;
      border-radius: 16px;
      padding: 12px 12px 14px 12px;
      background:
        radial-gradient(circle at top, rgba(15,23,42,0.75), transparent 65%),
        linear-gradient(to bottom, rgba(15,23,42,0.98), rgba(15,23,42,0.96));
      border: 1px solid rgba(148,163,184,0.65);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 16px 34px rgba(0,0,0,0.85);
      position: relative;
      overflow: hidden;
    }

    .phase::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top, rgba(251,191,36,0.09), transparent 60%),
        radial-gradient(circle at bottom, rgba(59,130,246,0.15), transparent 55%);
      opacity: 0.8;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .phase-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }

    .phase-title {
      font-family: "Cinzel", serif;
      font-size: 1.1rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .phase-tag {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent-gold);
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(250,204,21,0.7);
      background: radial-gradient(circle, rgba(250,204,21,0.12), transparent 60%);
    }

    .section-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin: 6px 0 4px 2px;
      position: relative;
      z-index: 1;
    }

    .grid-modifiers {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 4px 8px;
      margin-bottom: 8px;
      position: relative;
      z-index: 1;
    }

    .grid-modifiers label {
      font-size: 0.72rem;
      color: var(--text-muted);
      align-self: center;
    }

    .blue-input {
      width: 100%;
      border-radius: 6px;
      border: 1px solid rgba(51,65,85,0.95);
      padding: 3px 5px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(15,23,42,0.98));
      color: #e5e7eb;
      font-size: 0.75rem;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.95);
    }

    .blue-input.num {
      text-align: right;
    }

    .blue-input:focus {
      outline: none;
      border-color: rgba(96,165,250,0.9);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.95),
        0 0 0 1px rgba(96,165,250,0.6),
        0 0 12px rgba(37,99,235,0.45);
    }

    .blue-input.changed {
      animation: inputGlow 0.4s ease-out;
    }

    @keyframes inputGlow {
      0% {
        box-shadow:
          0 0 0 1px rgba(15,23,42,0.95),
          0 0 0 1px rgba(56,189,248,0.75),
          0 0 16px rgba(56,189,248,0.95);
      }
      100% {
        box-shadow:
          0 0 0 1px rgba(15,23,42,0.95),
          0 0 0 1px rgba(51,65,85,0.95),
          0 0 0 rgba(15,23,42,0);
      }
    }

    .table-wrapper {
      position: relative;
      z-index: 1;
      margin-bottom: 6px;
      border-radius: 10px;
      border: 1px solid rgba(55,65,81,0.9);
      background:
        radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(15,23,42,1));
      overflow: auto;
      max-height: 380px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.68rem;
      color: var(--text-main);
      min-width: 1150px;
    }

    th, td {
      border: 1px solid rgba(31,41,55,0.9);
      padding: 3px 4px;
      text-align: center;
    }

    th {
      background: linear-gradient(to bottom, rgba(15,23,42,0.95), rgba(15,23,42,0.9));
      color: #e5e7eb;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .item-label {
      text-align: left;
      background: linear-gradient(to right, rgba(15,23,42,0.95), rgba(15,23,42,0.7));
      font-weight: 500;
      font-size: 0.7rem;
    }

    tr.equip-row:hover {
      background: radial-gradient(circle at center, rgba(251,191,36,0.06), transparent 55%);
    }

    .outputs {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 6px 10px;
      font-size: 0.8rem;
      position: relative;
      z-index: 1;
    }

    .output-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
      background: linear-gradient(to right, rgba(15,23,42,0.95), rgba(17,24,39,0.9));
      border-radius: 6px;
      padding: 3px 6px;
      border: 1px solid rgba(55,65,81,0.9);
    }

    .output-row span.label {
      color: var(--text-muted);
    }

    .output-row span.value {
      min-width: 80px;
      text-align: right;
      font-weight: 600;
      color: #f9fafb;
      text-shadow:
        0 0 6px rgba(0,0,0,0.9),
        0 0 10px rgba(0,0,0,0.9);
    }

    .value.pulse {
      animation: valuePulse 0.5s ease-out;
    }

    @keyframes valuePulse {
      0% { color: #f9fafb; text-shadow: 0 0 4px rgba(251,191,36,0.2); }
      25% { color: #fef9c3; text-shadow: 0 0 18px rgba(251,191,36,0.9); }
      100% { color: #f9fafb; text-shadow: 0 0 6px rgba(0,0,0,0.9); }
    }

    .footer {
      max-width: 900px;
      margin: 18px auto 0 auto;
      padding: 12px 16px 16px 16px;
      border-radius: 14px;
      background:
        radial-gradient(circle at top, rgba(251,191,36,0.1), transparent 60%),
        linear-gradient(to bottom, rgba(15,23,42,0.96), rgba(12,16,26,0.98));
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 18px 36px rgba(0,0,0,0.85);
      display: flex;
      justify-content: center;
      gap: 46px;
      position: relative;
      overflow: hidden;
    }

    .footer::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 50% 0%, rgba(251,191,36,0.24), transparent 65%);
      opacity: 0.5;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .footer-beam {
      position: absolute;
      inset: -40px 45%;
      background:
        linear-gradient(to bottom,
          rgba(248,250,252,0.02),
          rgba(251,191,36,0.5),
          rgba(253,224,71,0.02)
        );
      filter: blur(1px);
      opacity: 0.75;
      mix-blend-mode: screen;
      animation: legendaryBeam 3.4s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes legendaryBeam {
      0% { transform: translateY(10px) scaleY(0.9); opacity: 0.55; }
      40% { transform: translateY(0) scaleY(1.1); opacity: 0.95; }
      100% { transform: translateY(10px) scaleY(0.9); opacity: 0.55; }
    }

    .footer-block {
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .footer-block span.label {
      font-family: "Cinzel", serif;
      font-size: 0.8rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .footer-block span.value {
      display: block;
      font-size: 1.45rem;
      font-weight: 700;
      margin-top: 4px;
      color: #fef9c3;
      text-shadow:
        0 0 10px rgba(0,0,0,0.95),
        0 0 18px rgba(251,191,36,0.8);
    }

    .footer-block span.value.pulse {
      animation: valuePulse 0.55s ease-out;
    }

    @media (max-width: 1100px) {
      .phase-container {
        flex-direction: column;
      }
    }

    @media (max-width: 720px) {
      body {
        padding: 16px;
      }
      .title-frame {
        padding: 10px 12px 14px 12px;
      }
      h1 {
        font-size: 1.4rem;
      }
      .grid-modifiers {
        grid-template-columns: 1.1fr 0.9fr;
      }
      .footer {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .footer-beam {
        inset: -40px 35%;
      }
    }
  </style>
</head>

<body>

<div class="title-frame">
  <h1>Diablo Immortal DPS Calculator</h1>
  <div class="subtitle">Auroth damage engine · twin-phase rift analysis</div>
</div>

<div class="phase-container">

  <!-- PHASE 1 -->
  <div class="phase phase1" id="phase1">
    <div class="phase-header">
      <div class="phase-title">Phase I</div>
      <div class="phase-tag">Arcane Rift Window</div>
    </div>

    <div class="section-title">General modifiers</div>
    <div class="grid-modifiers">
      <label for="p1_seconds">1st phase (seconds)</label>
      <input class="blue-input num" id="p1_seconds" type="number" step="0.01" value="20" />

      <label for="p1_resonance">Resonance</label>
      <input class="blue-input num" id="p1_resonance" type="number" step="1" value="1321" />

      <label for="p1_bed_mod">BED modifier</label>
      <input class="blue-input num" id="p1_bed_mod" type="number" step="0.01" value="1.0" />

      <label for="p1_vithus_bed">Vithus BED</label>
      <input class="blue-input num" id="p1_vithus_bed" type="number" step="0.01" value="0.30" />

      <label for="p1_baron_hed">Baron HED</label>
      <input class="blue-input num" id="p1_baron_hed" type="number" step="0.01" value="0.30" />

      <label for="p1_potency_hed">Potency HED</label>
      <input class="blue-input num" id="p1_potency_hed" type="number" step="0.01" value="0.35" />

      <label for="p1_misery_hed">Misery Elixir HED</label>
      <input class="blue-input num" id="p1_misery_hed" type="number" step="0.01" value="0.00" />

      <label for="p1_hed_mod">HED Modifier</label>
      <input class="blue-input num" id="p1_hed_mod" type="number" step="0.01" value="1.0" />

      <label for="p1_cdr_score">CDR Score</label>
      <input class="blue-input num" id="p1_cdr_score" type="number" step="0.01" value="1.43" />
    </div>

    <div class="section-title">Equipment</div>
    <div class="table-wrapper">
      <table>
        <thead>
        <tr>
          <th>Equipment</th>
          <th>Item Base DMG</th>
          <th>Item Base DMG increased %</th>
          <th>Rune increase</th>
          <th>Socket Rank</th>
          <th>Paragon DMG</th>
          <th>Horadrim</th>
          <th>Intelligence</th>
          <th>Tourmaline</th>
          <th>BED</th>
          <th>Dmg Mod (B1)</th>
          <th>B1 %</th>
          <th>Leg Gems (B2)</th>
          <th>B2 %</th>
          <th>Buff/Debuff (B3)</th>
          <th>B3 %</th>
          <th>CR (B4)</th>
          <th>Crit Chance</th>
          <th>Crit Damage</th>
          <th>Attack Speed</th>
        </tr>
        </thead>
        <tbody id="p1_equipment_body">

        <!-- PHASE 1 EQUIPMENT ROWS -->
        <tr class="equip-row" data-slot="neck">
          <td class="item-label">Neck</td>
          <td><input class="blue-input num" id="p1_neck_base" value="8880" /></td>
          <td><input class="blue-input num" id="p1_neck_base_inc" value="12" /></td>
          <td><input class="blue-input num" id="p1_neck_rune" value="0" /></td>
          <td><input class="blue-input num" id="p1_neck_socket" value="0" /></td>
          <td><input class="blue-input num" id="p1_neck_paragon" value="0" /></td>
          <td><input class="blue-input num" id="p1_neck_horadrim" value="0" /></td>
          <td><input class="blue-input num" id="p1_neck_int" value="106" /></td>
          <td><input class="blue-input num" id="p1_neck_tourm" value="148" /></td>
          <td><input class="blue-input num" id="p1_neck_bed" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_neck_b1_src" value="Primary dmg" /></td>
          <td><input class="blue-input num" id="p1_neck_b1_pct" step="0.01" value="0.21" /></td>
          <td><input class="blue-input" type="text" id="p1_neck_b2_src" value="BSJ" /></td>
          <td><input class="blue-input num" id="p1_neck_b2_pct" step="0.01" value="0.24" /></td>
          <td><input class="blue-input" type="text" id="p1_neck_b3_src" value="Shock" /></td>
          <td><input class="blue-input num" id="p1_neck_b3_pct" step="0.01" value="0.25" /></td>
          <td><input class="blue-input num" id="p1_neck_cr" step="0.01" value="0.113" /></td>
          <td><input class="blue-input num" id="p1_neck_crit_ch" step="0.01" value="0.14" /></td>
          <td><input class="blue-input num" id="p1_neck_crit_dmg" step="0.01" value="0.54" /></td>
          <td><input class="blue-input num" id="p1_neck_as" step="0.01" value="0" /></td>
        </tr>

        <tr class="equip-row" data-slot="ring1">
          <td class="item-label">Ring 1</td>
          <td><input class="blue-input num" id="p1_ring1_base" value="101" /></td>
          <td><input class="blue-input num" id="p1_ring1_base_inc" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_rune" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_socket" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_paragon" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_horadrim" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_int" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_tourm" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_bed" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_ring1_b1_src" value="Dmg done to ESLOC" /></td>
          <td><input class="blue-input num" id="p1_ring1_b1_pct" step="0.01" value="0.80" /></td>
          <td><input class="blue-input" type="text" id="p1_ring1_b2_src" value="Bottled Hope" /></td>
          <td><input class="blue-input num" id="p1_ring1_b2_pct" step="0.01" value="0.24" /></td>
          <td><input class="blue-input" type="text" id="p1_ring1_b3_src" value="Posion Golem Debuff" /></td>
          <td><input class="blue-input num" id="p1_ring1_b3_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_cr" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_crit_ch" step="0.01" value="0.19" /></td>
          <td><input class="blue-input num" id="p1_ring1_crit_dmg" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring1_as" step="0.01" value="0" /></td>
        </tr>

        <tr class="equip-row" data-slot="ring2">
          <td class="item-label">Ring 2</td>
          <td><input class="blue-input num" id="p1_ring2_base" value="920" /></td>
          <td><input class="blue-input num" id="p1_ring2_base_inc" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_rune" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_socket" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_paragon" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_horadrim" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_int" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_tourm" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_bed" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_ring2_b1_src" value="Essence Mastery" /></td>
          <td><input class="blue-input num" id="p1_ring2_b1_pct" step="0.01" value="0.2" /></td>
          <td><input class="blue-input" type="text" id="p1_ring2_b2_src" value="Pain Clasp" /></td>
          <td><input class="blue-input num" id="p1_ring2_b2_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_ring2_b3_src" value="Lingering Wounds" /></td>
          <td><input class="blue-input num" id="p1_ring2_b3_pct" step="0.01" value="0.388" /></td>
          <td><input class="blue-input num" id="p1_ring2_cr" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_crit_ch" step="0.01" value="0.24" /></td>
          <td><input class="blue-input num" id="p1_ring2_crit_dmg" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_ring2_as" step="0.01" value="0" /></td>
        </tr>

        <!-- Generic template rows for remaining slots, default 0 -->
        <!-- You can edit values to match your sheet exactly -->
        <tr class="equip-row" data-slot="gloves">
          <td class="item-label">Gloves</td>
          <td><input class="blue-input num" id="p1_gloves_base" value="831" /></td>
          <td><input class="blue-input num" id="p1_gloves_base_inc" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_rune" value="16" /></td>
          <td><input class="blue-input num" id="p1_gloves_socket" value="819" /></td>
          <td><input class="blue-input num" id="p1_gloves_paragon" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_horadrim" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_int" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_tourm" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_bed" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_gloves_b1_src" value="Gloomsguide" /></td>
          <td><input class="blue-input num" id="p1_gloves_b1_pct" step="0.01" value="0.15" /></td>
          <td><input class="blue-input" type="text" id="p1_gloves_b2_src" value="Follower's Burden" /></td>
          <td><input class="blue-input num" id="p1_gloves_b2_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input" type="text" id="p1_gloves_b3_src" value="Bloodless Hierophant" /></td>
          <td><input class="blue-input num" id="p1_gloves_b3_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_cr" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_crit_ch" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_crit_dmg" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p1_gloves_as" step="0.01" value="0" /></td>
        </tr>

        <!-- Repeat this pattern for: waist, feet, head, chest, shoulder, legs,
             mh1, oh1, mh2, oh2, wrist1, wrist2, tableau, dr
             (keeping IDs and slot names consistent with SLOTS in JS) -->

        </tbody>
      </table>
    </div>

    <div class="section-title">Outputs</div>
    <div class="outputs">
      <div class="output-row"><span class="label">Base DMG</span><span class="value" id="p1_base_dmg">0</span></div>
      <div class="output-row"><span class="label">Normal DMG</span><span class="value" id="p1_normal_dmg">0</span></div>
      <div class="output-row"><span class="label">Crit DMG</span><span class="value" id="p1_crit_dmg">0</span></div>
      <div class="output-row"><span class="label">Avg. DMG</span><span class="value" id="p1_avg_dmg">0</span></div>
      <div class="output-row"><span class="label">Banner DMG</span><span class="value" id="p1_banner_dmg">0</span></div>
      <div class="output-row"><span class="label">B1 score</span><span class="value" id="p1_b1_score">0</span></div>
      <div class="output-row"><span class="label">B2 score</span><span class="value" id="p1_b2_score">0</span></div>
      <div class="output-row"><span class="label">B3 score</span><span class="value" id="p1_b3_score">0</span></div>
      <div class="output-row"><span class="label">B4 score</span><span class="value" id="p1_b4_score">0</span></div>
      <div class="output-row"><span class="label">Crit score</span><span class="value" id="p1_crit_score">0</span></div>
      <div class="output-row"><span class="label">AS Score</span><span class="value" id="p1_as_score">0</span></div>
      <div class="output-row"><span class="label">Build Score</span><span class="value" id="p1_build_score">0</span></div>
      <div class="output-row"><span class="label">Build Score with AS</span><span class="value" id="p1_build_score_as">0</span></div>
    </div>
  </div>

  <!-- PHASE 2 -->
  <div class="phase phase2" id="phase2">
    <div class="phase-header">
      <div class="phase-title">Phase II</div>
      <div class="phase-tag">Infernal Rift Window</div>
    </div>

    <div class="section-title">General modifiers</div>
    <div class="grid-modifiers">
      <label for="p2_seconds">2nd phase (seconds)</label>
      <input class="blue-input num" id="p2_seconds" type="number" step="0.01" value="10" />

      <label for="p2_resonance">Resonance</label>
      <input class="blue-input num" id="p2_resonance" type="number" step="1" value="7233" />

      <label for="p2_bed_mod">BED modifier</label>
      <input class="blue-input num" id="p2_bed_mod" type="number" step="0.01" value="1.0" />

      <label for="p2_vithus_bed">Vithus BED</label>
      <input class="blue-input num" id="p2_vithus_bed" type="number" step="0.01" value="0.30" />

      <label for="p2_baron_hed">Baron HED</label>
      <input class="blue-input num" id="p2_baron_hed" type="number" step="0.01" value="0.30" />

      <label for="p2_potency_hed">Potency HED</label>
      <input class="blue-input num" id="p2_potency_hed" type="number" step="0.01" value="0.35" />

      <label for="p2_misery_hed">Misery Elixir HED</label>
      <input class="blue-input num" id="p2_misery_hed" type="number" step="0.01" value="0.00" />

      <label for="p2_hed_mod">HED Modifier</label>
      <input class="blue-input num" id="p2_hed_mod" type="number" step="0.01" value="1.0" />

      <label for="p2_cdr_score">CDR Score</label>
      <input class="blue-input num" id="p2_cdr_score" type="number" step="0.01" value="1.43" />
    </div>

    <div class="section-title">Equipment</div>
    <div class="table-wrapper">
      <table>
        <thead>
        <tr>
          <th>Equipment</th>
          <th>Item Base DMG</th>
          <th>Item Base DMG increased %</th>
          <th>Rune increase</th>
          <th>Socket Rank</th>
          <th>Paragon DMG</th>
          <th>Horadrim</th>
          <th>Intelligence</th>
          <th>Tourmaline</th>
          <th>BED</th>
          <th>Dmg Mod (B1)</th>
          <th>B1 %</th>
          <th>Leg Gems (B2)</th>
          <th>B2 %</th>
          <th>Buff/Debuff (B3)</th>
          <th>B3 %</th>
          <th>CR (B4)</th>
          <th>Crit Chance</th>
          <th>Crit Damage</th>
          <th>Attack Speed</th>
        </tr>
        </thead>
        <tbody id="p2_equipment_body">

        <!-- PHASE 2 EQUIPMENT ROWS -->
        <tr class="equip-row" data-slot="neck">
          <td class="item-label">Neck</td>
          <td><input class="blue-input num" id="p2_neck_base" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_base_inc" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_rune" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_socket" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_paragon" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_horadrim" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_int" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_tourm" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_bed" value="0" /></td>
          <td><input class="blue-input" type="text" id="p2_neck_b1_src" value="" /></td>
          <td><input class="blue-input num" id="p2_neck_b1_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input" type="text" id="p2_neck_b2_src" value="" /></td>
          <td><input class="blue-input num" id="p2_neck_b2_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input" type="text" id="p2_neck_b3_src" value="" /></td>
          <td><input class="blue-input num" id="p2_neck_b3_pct" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_cr" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_crit_ch" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_crit_dmg" step="0.01" value="0" /></td>
          <td><input class="blue-input num" id="p2_neck_as" step="0.01" value="0" /></td>
        </tr>

        <!-- Repeat same pattern for all slots as Phase 1 (ring1, ring2, gloves, waist, feet, head, chest, shoulder, legs, mh1, oh1, mh2, oh2, wrist1, wrist2, tableau, dr) -->

        </tbody>
      </table>
    </div>

    <div class="section-title">Outputs</div>
    <div class="outputs">
      <div class="output-row"><span class="label">Base DMG</span><span class="value" id="p2_base_dmg">0</span></div>
      <div class="output-row"><span class="label">Normal DMG</span><span class="value" id="p2_normal_dmg">0</span></div>
      <div class="output-row"><span class="label">Crit DMG</span><span class="value" id="p2_crit_dmg">0</span></div>
      <div class="output-row"><span class="label">Avg. DMG</span><span class="value" id="p2_avg_dmg">0</span></div>
      <div class="output-row"><span class="label">Banner DMG</span><span class="value" id="p2_banner_dmg">0</span></div>
      <div class="output-row"><span class="label">B1 score</span><span class="value" id="p2_b1_score">0</span></div>
      <div class="output-row"><span class="label">B2 score</span><span class="value" id="p2_b2_score">0</span></div>
      <div class="output-row"><span class="label">B3 score</span><span class="value" id="p2_b3_score">0</span></div>
      <div class="output-row"><span class="label">B4 score</span><span class="value" id="p2_b4_score">0</span></div>
      <div class="output-row"><span class="label">Crit score</span><span class="value" id="p2_crit_score">0</span></div>
      <div class="output-row"><span class="label">AS Score</span><span class="value" id="p2_as_score">0</span></div>
      <div class="output-row"><span class="label">Build Score</span><span class="value" id="p2_build_score">0</span></div>
      <div class="output-row"><span class="label">Build Score with AS</span><span class="value" id="p2_build_score_as">0</span></div>
    </div>
  </div>
</div>

<div class="footer">
  <div class="footer-beam"></div>
  <div class="footer-block">
    <span class="label">20 Sec Score</span>
    <span class="value" id="score_20sec">0</span>
  </div>
  <div class="footer-block">
    <span class="label">20 Sec Score with AS</span>
    <span class="value" id="score_20sec_as">0</span>
  </div>
</div>

<script>
  /* --- Utility Functions --- */
  function getNum(id) {
    const el = document.getElementById(id);
    if (!el) return 0;
    const v = parseFloat(el.value);
    return isNaN(v) ? 0 : v;
  }

  function setTextAndPulse(id, value, decimals = 2) {
    const el = document.getElementById(id);
    if (!el) return;
    const old = el.textContent;
    const newVal = Number(value || 0).toFixed(decimals);
    el.textContent = newVal;
    if (old !== newVal) {
      el.classList.remove("pulse");
      void el.offsetWidth;
      el.classList.add("pulse");
    }
  }

  const SLOTS = [
    "neck","ring1","ring2",
    "gloves","waist","feet",
    "head","chest","shoulder","legs",
    "mh1","oh1","mh2","oh2",
    "wrist1","wrist2","tableau","dr"
  ];

  function sumPhase(phase, suffix) {
    return SLOTS.reduce((acc, slot) => {
      const id = `${phase}_${slot}_${suffix}`;
      return acc + getNum(id);
    }, 0);
  }

  /* --- Main Recalculation --- */
  function recalc() {
    const p1_seconds = getNum("p1_seconds");
    const p2_seconds = getNum("p2_seconds");

    /* --- Phase 1 Totals --- */
    let p1_total_base = 0;
    let p1_total_rune = 0;
    let p1_total_socket = 0;
    let p1_total_paragon = 0;
    let p1_total_horadrim = 0;
    let p1_total_int = 0;
    let p1_total_tourm = 0;
    let p1_total_bed = 0;
    let p1_total_b1pct = 0;
    let p1_total_b2pct = 0;
    let p1_total_b3pct = 0;
    let p1_total_b4 = 0;
    let p1_total_crit_ch = 0;
    let p1_total_crit_dmg = 0;
    let p1_total_as = 0;

    SLOTS.forEach(slot => {
      const baseRaw = getNum(`p1_${slot}_base`);
      const baseIncPct = getNum(`p1_${slot}_base_inc`); // as fraction (e.g. 12 => 12%)
      const baseIncMult = 1 + (baseIncPct / 100);
      const baseEffective = baseRaw * baseIncMult;

      p1_total_base += baseEffective;
      p1_total_rune += getNum(`p1_${slot}_rune`);
      p1_total_socket += getNum(`p1_${slot}_socket`);
      p1_total_paragon += getNum(`p1_${slot}_paragon`);
      p1_total_horadrim += getNum(`p1_${slot}_horadrim`);
      p1_total_int += getNum(`p1_${slot}_int`);
      p1_total_tourm += getNum(`p1_${slot}_tourm`);
      p1_total_bed += getNum(`p1_${slot}_bed`);
      p1_total_b1pct += getNum(`p1_${slot}_b1_pct`);
      p1_total_b2pct += getNum(`p1_${slot}_b2_pct`);
      p1_total_b3pct += getNum(`p1_${slot}_b3_pct`);
      p1_total_b4 += getNum(`p1_${slot}_cr`);
      p1_total_crit_ch += getNum(`p1_${slot}_crit_ch`);
      p1_total_crit_dmg += getNum(`p1_${slot}_crit_dmg`);
      p1_total_as += getNum(`p1_${slot}_as`);
    });

    const p1_b1_sum = p1_total_b1pct;
    const p1_b2_sum = p1_total_b2pct;
    const p1_b3_sum = p1_total_b3pct;
    const p1_b4_sum = Math.min(p1_total_b4, 1);
    const p1_crit_ch = Math.min(p1_total_crit_ch, 1);
    const p1_crit_dmg = Math.max(p1_total_crit_dmg, 0);
    const p1_as_sum = Math.min(p1_total_as, 2.2);

    const resonance1 = getNum("p1_resonance");
    const vithus_bed1 = getNum("p1_vithus_bed");
    const baron_hed1 = getNum("p1_baron_hed");
    const potency_hed1 = getNum("p1_potency_hed");
    const misery_hed1 = getNum("p1_misery_hed");
    const cdrScore1 = getNum("p1_cdr_score");

    const bedMod1 = (1 + p1_total_bed) * (1 + vithus_bed1);
    const hedMod1 = (1 + baron_hed1) * (1 + potency_hed1) * (1 + misery_hed1);

    // Base damage: item base (with inc%), plus CDR scaling, plus tourm, INT scaling, paragon, horadrim, rune, socket
    const p1_base_dmg =
      p1_total_base +
      (p1_total_base * cdrScore1 * 0.0005) +
      p1_total_tourm +
      p1_total_int * 0.3 +
      p1_total_paragon +
      p1_total_horadrim +
      p1_total_rune +
      p1_total_socket;

    const p1_L5 = p1_base_dmg * (1 + resonance1 * 0.0005) * bedMod1 * hedMod1;

    const p1_b1_mult = 1 + p1_b1_sum;
    const p1_b2_mult = 1 + p1_b2_sum;
    const p1_b3_mult = 1 + p1_b3_sum;
    const p1_b4_mult = 1 + p1_b4_sum;

    const p1_normal = p1_L5 * p1_b1_mult * p1_b2_mult * p1_b3_mult * p1_b4_mult;

    // Crit multiplier: 1 + critChance * (1 + critDamage)
    const p1_crit_mult = 1 + p1_crit_ch * (1 + p1_crit_dmg);
    const p1_crit = p1_L5 * p1_crit_mult;

    // Average damage: weight between normal and crit using crit chance and crit damage
    const p1_avg_mult = 1 + p1_crit_ch * p1_crit_dmg;
    const p1_avg = p1_L5 * p1_avg_mult;

    const p1_V5 = 1 + p1_as_sum;
    const p1_banner = p1_crit * p1_V5;

    const p1_b1_score = p1_b1_mult;
    const p1_b2_score = p1_b2_mult;
    const p1_b3_score = p1_b3_mult;
    const p1_b4_score = p1_b4_mult;
    const p1_crit_score = 1 + p1_crit_ch * (1 + p1_crit_dmg);
    const p1_as_score = 1 + p1_as_sum;

    const p1_build = p1_b1_score * p1_b2_score * p1_b3_score * p1_b4_score * p1_crit_score;
    const p1_build_as = p1_build * p1_as_score;

    setTextAndPulse("p1_base_dmg", p1_base_dmg, 1);
    setTextAndPulse("p1_normal_dmg", p1_normal, 0);
    setTextAndPulse("p1_crit_dmg", p1_crit, 0);
    setTextAndPulse("p1_avg_dmg", p1_avg, 0);
    setTextAndPulse("p1_banner_dmg", p1_banner, 0);
    setTextAndPulse("p1_b1_score", p1_b1_score, 3);
    setTextAndPulse("p1_b2_score", p1_b2_score, 3);
    setTextAndPulse("p1_b3_score", p1_b3_score, 3);
    setTextAndPulse("p1_b4_score", p1_b4_score, 3);
    setTextAndPulse("p1_crit_score", p1_crit_score, 3);
    setTextAndPulse("p1_as_score", p1_as_score, 3);
    setTextAndPulse("p1_build_score", p1_build, 3);
    setTextAndPulse("p1_build_score_as", p1_build_as, 3);

    /* --- Phase 2 Totals --- */
    let p2_total_base = 0;
    let p2_total_rune = 0;
    let p2_total_socket = 0;
    let p2_total_paragon = 0;
    let p2_total_horadrim = 0;
    let p2_total_int = 0;
    let p2_total_tourm = 0;
    let p2_total_bed = 0;
    let p2_total_b1pct = 0;
    let p2_total_b2pct = 0;
    let p2_total_b3pct = 0;
    let p2_total_b4 = 0;
    let p2_total_crit_ch = 0;
    let p2_total_crit_dmg = 0;
    let p2_total_as = 0;

    SLOTS.forEach(slot => {
      const baseRaw = getNum(`p2_${slot}_base`);
      const baseIncPct = getNum(`p2_${slot}_base_inc`);
      const baseIncMult = 1 + (baseIncPct / 100);
      const baseEffective = baseRaw * baseIncMult;

      p2_total_base += baseEffective;
      p2_total_rune += getNum(`p2_${slot}_rune`);
      p2_total_socket += getNum(`p2_${slot}_socket`);
      p2_total_paragon += getNum(`p2_${slot}_paragon`);
      p2_total_horadrim += getNum(`p2_${slot}_horadrim`);
      p2_total_int += getNum(`p2_${slot}_int`);
      p2_total_tourm += getNum(`p2_${slot}_tourm`);
      p2_total_bed += getNum(`p2_${slot}_bed`);
      p2_total_b1pct += getNum(`p2_${slot}_b1_pct`);
      p2_total_b2pct += getNum(`p2_${slot}_b2_pct`);
      p2_total_b3pct += getNum(`p2_${slot}_b3_pct`);
      p2_total_b4 += getNum(`p2_${slot}_cr`);
      p2_total_crit_ch += getNum(`p2_${slot}_crit_ch`);
      p2_total_crit_dmg += getNum(`p2_${slot}_crit_dmg`);
      p2_total_as += getNum(`p2_${slot}_as`);
    });

    const p2_b1_sum = p2_total_b1pct;
    const p2_b2_sum = p2_total_b2pct;
    const p2_b3_sum = p2_total_b3pct;
    const p2_b4_sum = Math.min(p2_total_b4, 1);
    const p2_crit_ch = Math.min(p2_total_crit_ch, 1);
    const p2_crit_dmg = Math.max(p2_total_crit_dmg, 0);
    const p2_as_sum = Math.min(p2_total_as, 2.2);

    const resonance2 = getNum("p2_resonance");
    const vithus_bed2 = getNum("p2_vithus_bed");
    const baron_hed2 = getNum("p2_baron_hed");
    const potency_hed2 = getNum("p2_potency_hed");
    const misery_hed2 = getNum("p2_misery_hed");
    const cdrScore2 = getNum("p2_cdr_score");

    const bedMod2 = (1 + p2_total_bed) * (1 + vithus_bed2);
    const hedMod2 = (1 + baron_hed2) * (1 + potency_hed2) * (1 + misery_hed2);

    const p2_base_dmg =
      p2_total_base +
      (p2_total_base * cdrScore2 * 0.0005) +
      p2_total_tourm +
      p2_total_int * 0.3 +
      p2_total_paragon +
      p2_total_horadrim +
      p2_total_rune +
      p2_total_socket;

    const p2_L5 = p2_base_dmg * (1 + resonance2 * 0.0005) * bedMod2 * hedMod2;

    const p2_b1_mult = 1 + p2_b1_sum;
    const p2_b2_mult = 1 + p2_b2_sum;
    const p2_b3_mult = 1 + p2_b3_sum;
    const p2_b4_mult = 1 + p2_b4_sum;

    const p2_normal = p2_L5 * p2_b1_mult * p2_b2_mult * p2_b3_mult * p2_b4_mult;

    const p2_crit_mult = 1 + p2_crit_ch * (1 + p2_crit_dmg);
    const p2_crit = p2_L5 * p2_crit_mult;

    const p2_avg_mult = 1 + p2_crit_ch * p2_crit_dmg;
    const p2_avg = p2_L5 * p2_avg_mult;

    const p2_V5 = 1 + p2_as_sum;
    const p2_banner = p2_crit * p2_V5;

    const p2_b1_score = p2_b1_mult;
    const p2_b2_score = p2_b2_mult;
    const p2_b3_score = p2_b3_mult;
    const p2_b4_score = p2_b4_mult;
    const p2_crit_score = 1 + p2_crit_ch * (1 + p2_crit_dmg);
    const p2_as_score = 1 + p2_as_sum;

    const p2_build = p2_b1_score * p2_b2_score * p2_b3_score * p2_b4_score * p2_crit_score;
    const p2_build_as = p2_build * p2_as_score;

    setTextAndPulse("p2_base_dmg", p2_base_dmg, 1);
    setTextAndPulse("p2_normal_dmg", p2_normal, 0);
    setTextAndPulse("p2_crit_dmg", p2_crit, 0);
    setTextAndPulse("p2_avg_dmg", p2_avg, 0);
    setTextAndPulse("p2_banner_dmg", p2_banner, 0);
    setTextAndPulse("p2_b1_score", p2_b1_score, 3);
    setTextAndPulse("p2_b2_score", p2_b2_score, 3);
    setTextAndPulse("p2_b3_score", p2_b3_score, 3);
    setTextAndPulse("p2_b4_score", p2_b4_score, 3);
    setTextAndPulse("p2_crit_score", p2_crit_score, 3);
    setTextAndPulse("p2_as_score", p2_as_score, 3);
    setTextAndPulse("p2_build_score", p2_build, 3);
    setTextAndPulse("p2_build_score_as", p2_build_as, 3);

    /* --- Final 20-second Scores --- */
    const totalSeconds = Math.max(p1_seconds + p2_seconds, 1);
    const score20 = ((p1_build * p1_seconds) + (p2_build * p2_seconds)) / totalSeconds * (20 / totalSeconds);
    const score20_as = ((p1_build_as * p1_seconds) + (p2_build_as * p2_seconds)) / totalSeconds * (20 / totalSeconds);

    setTextAndPulse("score_20sec", score20, 2);
    setTextAndPulse("score_20sec_as", score20_as, 2);
  }

  /* --- Input Listeners --- */
  function attachListeners() {
    const inputs = document.querySelectorAll("input.num");
    inputs.forEach(inp => {
      inp.addEventListener("input", () => {
        inp.classList.remove("changed");
        void inp.offsetWidth;
        inp.classList.add("changed");
        recalc();
      });
    });
  }

  window.addEventListener("load", () => {
    attachListeners();
    recalc();
  });
</script>

</body>
</html>
